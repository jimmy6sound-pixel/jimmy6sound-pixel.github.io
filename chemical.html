<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¹å¹´çº§åŒ–å­¦åŠ©æ‰‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- 1. ç³»ç»Ÿçº§åŸºç¡€æ ·å¼ (Mobile First) --- */
        :root {
            --app-bg: #F2F2F7; /* iOS é£æ ¼ç°åº• */
            --card-bg: #FFFFFF;
            --primary: #007AFF; /* iOS è“ */
            --text-dark: #000000;
            --text-gray: #8E8E93;
            --border-color: #E5E5EA;
            
            /* åŠŸèƒ½è‰² */
            --color-unit: #5856D6; /* ç´« */
            --color-quiz: #FF2D55; /* çº¢ */
            --color-game1: #FF9500; /* æ©™ */
            --color-game2: #34C759; /* ç»¿ */
            
            --radius-card: 16px;
            --radius-btn: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.04);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", sans-serif; }
        
        body { background-color: var(--app-bg); color: var(--text-dark); padding-bottom: 40px; line-height: 1.5; }

        button { border: none; outline: none; background: none; cursor: pointer; }

        /* --- 2. é¡µé¢å®¹å™¨ä¸åŠ¨ç”» --- */
        .page { 
            display: none; 
            padding: 80px 16px 30px; /* é¡¶éƒ¨ç•™å‡ºå¯¼èˆªæ é«˜åº¦ */
            min-height: 100vh;
        }
        .page.active { 
            display: block; 
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 3. é¡¶éƒ¨å¯¼èˆªæ  (å›ºå®š) --- */
        .navbar {
            position: fixed; top: 0; left: 0; right: 0; height: 60px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            z-index: 9999; /* ç¡®ä¿æœ€é¡¶å±‚ */
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 12px;
        }
        
        .nav-action {
            width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: var(--primary);
            border-radius: 50%; transition: 0.2s;
        }
        .nav-action:active { background: #f0f0f0; }
        
        .nav-title { font-weight: 600; font-size: 17px; }

        /* --- 4. é¦–é¡µ UI --- */
        .hero-banner {
            background: linear-gradient(135deg, #007AFF, #5856D6);
            color: white; padding: 24px; border-radius: 20px;
            margin-bottom: 24px; box-shadow: 0 8px 20px rgba(0,122,255,0.25);
        }
        .hero-banner h1 { font-size: 22px; margin-bottom: 6px; }
        .hero-banner p { opacity: 0.9; font-size: 14px; }

        .section-header {
            font-size: 13px; font-weight: 600; color: var(--text-gray);
            text-transform: uppercase; letter-spacing: 0.5px;
            margin: 20px 0 10px 4px;
        }

        /* åŠŸèƒ½ç½‘æ ¼ */
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        
        .app-card {
            background: var(--card-bg); border-radius: 20px; padding: 16px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            box-shadow: var(--shadow); transition: transform 0.1s;
        }
        .app-card:active { transform: scale(0.96); background: #f9f9f9; }
        
        .app-icon {
            width: 56px; height: 56px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            font-size: 26px; margin-bottom: 12px; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .app-card h3 { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .app-card span { font-size: 12px; color: var(--text-gray); }

        /* åˆ—è¡¨å¼æŒ‰é’® */
        .list-cell {
            background: var(--card-bg); padding: 16px;
            display: flex; align-items: center; gap: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .list-cell:first-child { border-top-left-radius: 16px; border-top-right-radius: 16px; }
        .list-cell:last-child { border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; border-bottom: none; }
        .list-cell:active { background: #e5e5e5; }
        
        .cell-icon {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 18px;
        }
        .cell-content { flex: 1; }
        .cell-title { font-size: 16px; font-weight: 500; }
        .cell-sub { font-size: 12px; color: var(--text-gray); }

        /* --- 5. å†…å®¹è¯¦æƒ…é¡µ --- */
        .content-paper {
            background: var(--card-bg); padding: 24px; border-radius: 16px;
            box-shadow: var(--shadow); line-height: 1.7;
        }
        .content-paper h3 { color: var(--primary); margin: 24px 0 12px; font-size: 18px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .content-paper h4 { background: #F2F2F7; padding: 6px 10px; border-radius: 6px; display: inline-block; font-size: 15px; margin-top: 12px; }
        .highlight { background: #FFF8D6; color: #B76E00; padding: 2px 4px; border-radius: 4px; }
        
        table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 13px; }
        th { background: #F2F2F7; padding: 8px; text-align: center; font-weight: 600; }
        td { border: 1px solid #E5E5EA; padding: 8px; text-align: center; }

        /* --- 6. æ¸¸æˆä¸æµ‹éªŒ --- */
        .game-box {
            background: var(--card-bg); border-radius: 24px; padding: 30px 20px;
            text-align: center; box-shadow: var(--shadow);
        }
        .big-display {
            font-size: 60px; font-weight: 800; color: var(--text-dark);
            margin: 30px 0; height: 80px; display: flex; align-items: center; justify-content: center;
        }
        .option-btn {
            width: 100%; padding: 16px; margin-bottom: 12px;
            background: #F2F2F7; border-radius: 14px;
            font-size: 16px; font-weight: 600; color: var(--text-dark);
            transition: 0.2s; border: 2px solid transparent;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-btn.correct { background: #D4F7DC; border-color: #34C759; color: #145926; }
        .option-btn.wrong { background: #FFDCE4; border-color: #FF2D55; color: #750D22; }

        .quiz-bar-bg { height: 6px; background: #E5E5EA; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
        .quiz-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }
        
        .btn-primary {
            width: 100%; padding: 16px; background: var(--primary); color: white;
            font-size: 16px; font-weight: 600; border-radius: 14px;
            margin-top: 20px; box-shadow: 0 4px 10px rgba(0,122,255,0.3);
        }
        .btn-primary:active { opacity: 0.8; transform: scale(0.98); }

        /* --- 7. å…ƒç´ è¡¨åˆ—è¡¨é¡¹ --- */
        .pt-row {
            display: flex; align-items: center; background: var(--card-bg);
            padding: 12px 16px; margin-bottom: 1px;
        }
        .pt-row:first-child { border-top-left-radius: 12px; border-top-right-radius: 12px; }
        .pt-row:last-child { border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; }
        .pt-num { width: 30px; color: var(--text-gray); font-weight: 600; font-size: 14px; }
        .pt-sym { width: 50px; font-size: 20px; font-weight: 700; color: var(--primary); }
        .pt-name { font-size: 16px; font-weight: 500; }

    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div style="width: 44px;">
            <!-- é€€å‡ºæŒ‰é’® (å›åˆ° index.html) -->
            <a href="index.html" class="nav-action" id="exitBtn" title="é€€å‡º">
                <i class="fas fa-times"></i>
            </a>
            <!-- è¿”å›æŒ‰é’® (Appå†…è¿”å›) -->
            <button class="nav-action" id="backBtn" onclick="goHome()" style="display:none;">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="nav-title" id="navTitle">ä¹å¹´çº§åŒ–å­¦åŠ©æ‰‹</div>
        
        <!-- å³ä¾§å ä½ï¼Œä¿æŒæ ‡é¢˜å±…ä¸­ -->
        <div style="width: 44px;"></div>
    </nav>

    <!-- 1. é¦–é¡µ -->
    <div id="p-home" class="page active">
        <div class="hero-banner">
            <h1>åŒ–å­¦å¤ä¹ ä¼´ä¾£</h1>
            <p>çŸ¥è¯†ç‚¹ã€é¢˜åº“ã€è®°å¿†å·¥å…·ä¸€ç«™å¼æå®š</p>
        </div>

        <div class="section-header">å­¦ä¹ æ¨¡å¼</div>
        <div class="grid-menu">
            <div class="app-card" onclick="openUnits()">
                <div class="app-icon" style="background: var(--color-unit);">
                    <i class="fas fa-book"></i>
                </div>
                <h3>å•å…ƒç²¾è®²</h3>
                <span>è€ƒç‚¹å…¨è§£</span>
            </div>
            <div class="app-card" onclick="switchPage('p-quiz-menu', 'é¢˜åº“ä¸­å¿ƒ')">
                <div class="app-icon" style="background: var(--color-quiz);">
                    <i class="fas fa-check-square"></i>
                </div>
                <h3>æ™ºèƒ½åˆ·é¢˜</h3>
                <span>100+ çœŸé¢˜</span>
            </div>
            <div class="app-card" onclick="startGame('element')">
                <div class="app-icon" style="background: var(--color-game1);">
                    <i class="fas fa-bolt"></i>
                </div>
                <h3>å…ƒç´ è®°å¿†</h3>
                <span>é—ªç”µæˆ˜æ¸¸æˆ</span>
            </div>
            <div class="app-card" onclick="startGame('formula')">
                <div class="app-icon" style="background: var(--color-game2);">
                    <i class="fas fa-vial"></i>
                </div>
                <h3>å…¬å¼èƒŒè¯µ</h3>
                <span>åŒ–å­¦å¼é—¯å…³</span>
            </div>
        </div>

        <div class="section-header">é€ŸæŸ¥å·¥å…·</div>
        <div style="border-radius: 16px; overflow: hidden; box-shadow: var(--shadow);">
            <div class="list-cell" onclick="renderPT(); switchPage('p-pt', 'å…ƒç´ å‘¨æœŸè¡¨')">
                <div class="cell-icon" style="background: #FF9500;"><i class="fas fa-th"></i></div>
                <div class="cell-content">
                    <div class="cell-title">å…ƒç´ å‘¨æœŸè¡¨</div>
                    <div class="cell-sub">å‰20å·å…ƒç´  + å¸¸è§é‡‘å±</div>
                </div>
                <i class="fas fa-chevron-right" style="color:#C7C7CC;"></i>
            </div>
            <div class="list-cell" onclick="renderFormulas(); switchPage('p-formulas', 'æ ¸å¿ƒå…¬å¼')">
                <div class="cell-icon" style="background: #AF52DE;"><i class="fas fa-flask"></i></div>
                <div class="cell-content">
                    <div class="cell-title">æ ¸å¿ƒå…¬å¼åº“</div>
                    <div class="cell-sub">åŒ–åˆä»· Â· ååº”æ–¹ç¨‹å¼</div>
                </div>
                <i class="fas fa-chevron-right" style="color:#C7C7CC;"></i>
            </div>
        </div>
    </div>

    <!-- 2. å•å…ƒåˆ—è¡¨ -->
    <div id="p-units" class="page">
        <div id="unit-list-wrapper" style="border-radius: 16px; overflow: hidden; box-shadow: var(--shadow);">
            <!-- JS å¡«å…… -->
        </div>
    </div>

    <!-- 3. å•å…ƒè¯¦æƒ… -->
    <div id="p-detail" class="page">
        <div id="detail-content" class="content-paper"></div>
    </div>

    <!-- 4. æ¸¸æˆç•Œé¢ -->
    <div id="p-game" class="page">
        <div class="game-box">
            <div style="display:flex; justify-content:space-between; color:var(--text-gray); font-size:14px; font-weight:600;">
                <span>è¿å¯¹: <span id="g-streak" style="color:var(--color-game1)">0</span></span>
                <span>å¾—åˆ†: <span id="g-score" style="color:var(--primary)">0</span></span>
            </div>
            
            <div id="g-card" class="big-display">Ca</div>
            
            <div id="g-opts">
                <!-- é€‰é¡¹æŒ‰é’® -->
            </div>
            
            <div id="g-msg" style="height:24px; margin-top:16px; font-weight:600; color:var(--primary);"></div>
        </div>
        <button class="btn-primary" style="background:#E5E5EA; color:var(--text-gray); margin-top:30px;" onclick="goHome()">é€€å‡ºæ¸¸æˆ</button>
    </div>

    <!-- 5. é¢˜åº“èœå• -->
    <div id="p-quiz-menu" class="page">
        <div style="text-align:center; padding:20px 0;">
            <h2 style="margin-bottom:8px;">é€‰æ‹©æµ‹è¯•æ¨¡å¼</h2>
            <p style="color:var(--text-gray); font-size:14px; margin-bottom:30px;">å·²æ”¶å½• 100+ é“ç²¾é€‰è€ƒé¢˜</p>
            
            <button class="btn-primary" onclick="startQuiz('full')">ğŸš€ ç»¼åˆæ¨¡æ‹Ÿè€ƒ (20é¢˜)</button>
            
            <div class="section-header" style="text-align:left; margin-top:30px;">æŒ‰å•å…ƒç»ƒä¹ </div>
            <div id="quiz-unit-grid" class="grid-menu">
                <!-- JS å¡«å…… -->
            </div>
        </div>
    </div>

    <!-- 6. æµ‹éªŒè¿›è¡Œä¸­ -->
    <div id="p-quiz-run" class="page">
        <div class="quiz-bar-bg"><div id="q-bar" class="quiz-bar-fill"></div></div>
        
        <div style="display:flex; justify-content:space-between; color:var(--text-gray); font-size:13px; margin-bottom:16px;">
            <span id="q-tag">ç»¼åˆ</span>
            <span id="q-count">1/20</span>
        </div>
        
        <div id="q-text" style="font-size:18px; font-weight:600; margin-bottom:24px;"></div>
        
        <div id="q-opts"></div>
        
        <div id="q-feedback" style="background:#F2F2F7; padding:16px; border-radius:12px; margin-top:20px; display:none; font-size:14px;"></div>
        
        <button id="q-next" class="btn-primary" style="display:none;" onclick="nextQ()">ä¸‹ä¸€é¢˜</button>
    </div>

    <!-- 7. ç»“æœé¡µ -->
    <div id="p-result" class="page">
        <div class="content-paper" style="text-align:center; padding:40px 20px;">
            <div style="width:100px; height:100px; border-radius:50%; background:#F2F2F7; color:var(--primary); display:flex; align-items:center; justify-content:center; font-size:36px; font-weight:800; margin:0 auto 20px;">
                <span id="res-score">95</span>
            </div>
            <h2 id="res-title">å¤ªæ£’äº†ï¼</h2>
            <p id="res-desc" style="color:var(--text-gray); font-size:14px; margin:10px 0 30px;">åŸºç¡€éå¸¸æ‰å®ï¼Œç»§ç»­ä¿æŒï¼</p>
            <button class="btn-primary" onclick="goHome()">è¿”å›é¦–é¡µ</button>
        </div>
    </div>

    <!-- 8. åˆ—è¡¨é¡µå®¹å™¨ -->
    <div id="p-pt" class="page"><div id="pt-list"></div></div>
    <div id="p-formulas" class="page"><div id="formula-list"></div></div>

    <script>
        // ================= 1. æ•°æ®å®šä¹‰ (Data) =================
        
        // æ¸¸æˆæ•°æ®
        const GAME_DATA = {
            element: [
                {s:"H",n:"æ°¢"},{s:"He",n:"æ°¦"},{s:"Li",n:"é”‚"},{s:"Be",n:"é“"},{s:"B",n:"ç¡¼"},
                {s:"C",n:"ç¢³"},{s:"N",n:"æ°®"},{s:"O",n:"æ°§"},{s:"F",n:"æ°Ÿ"},{s:"Ne",n:"æ°–"},
                {s:"Na",n:"é’ "},{s:"Mg",n:"é•"},{s:"Al",n:"é“"},{s:"Si",n:"ç¡…"},{s:"P",n:"ç£·"},
                {s:"S",n:"ç¡«"},{s:"Cl",n:"æ°¯"},{s:"Ar",n:"æ°©"},{s:"K",n:"é’¾"},{s:"Ca",n:"é’™"},
                {s:"Fe",n:"é“"},{s:"Cu",n:"é“œ"},{s:"Zn",n:"é”Œ"},{s:"Ag",n:"é“¶"},{s:"Hg",n:"æ±"},
                {s:"Mn",n:"é”°"},{s:"Ba",n:"é’¡"},{s:"Au",n:"é‡‘"},{s:"I",n:"ç¢˜"}
            ],
            formula: [
                {s:"Hâ‚‚O",n:"æ°´"},{s:"COâ‚‚",n:"äºŒæ°§åŒ–ç¢³"},{s:"Oâ‚‚",n:"æ°§æ°”"},{s:"Pâ‚‚Oâ‚…",n:"äº”æ°§åŒ–äºŒç£·"},
                {s:"Feâ‚ƒOâ‚„",n:"å››æ°§åŒ–ä¸‰é“"},{s:"KMnOâ‚„",n:"é«˜é”°é…¸é’¾"},{s:"Hâ‚‚Oâ‚‚",n:"è¿‡æ°§åŒ–æ°¢"},
                {s:"MnOâ‚‚",n:"äºŒæ°§åŒ–é”°"},{s:"HCl",n:"ç›é…¸"},{s:"CaCOâ‚ƒ",n:"ç¢³é…¸é’™"},
                {s:"Ca(OH)â‚‚",n:"æ°¢æ°§åŒ–é’™"},{s:"NaCl",n:"æ°¯åŒ–é’ "},{s:"Hâ‚‚SOâ‚„",n:"ç¡«é…¸"},{s:"CO",n:"ä¸€æ°§åŒ–ç¢³"}
            ]
        };

        // å•å…ƒå¤ä¹ æ•°æ®
        const UNIT_DB = [
            {id:1, t:"Unit 1 èµ°è¿›åŒ–å­¦ä¸–ç•Œ", c:`<h3>1. ç‰©è´¨çš„å˜åŒ–</h3><p><span class="highlight">ç‰©ç†å˜åŒ–</span>ï¼šæ— æ–°ç‰©è´¨ç”Ÿæˆï¼ˆå†°èåŒ–ã€æ±½æ²¹æŒ¥å‘ï¼‰ã€‚<br><span class="highlight">åŒ–å­¦å˜åŒ–</span>ï¼šæœ‰æ–°ç‰©è´¨ç”Ÿæˆï¼ˆç‡ƒçƒ§ã€ç”Ÿé”ˆã€å˜è´¨ï¼‰ã€‚</p><h3>2. ä»ªå™¨ä½¿ç”¨</h3><p><strong>è¯•ç®¡</strong>ï¼šå¯ç›´æ¥åŠ çƒ­ï¼Œæ¶²ä¸è¶…1/3ã€‚<br><strong>é‡ç­’</strong>ï¼šè§†çº¿ä¸å‡¹æ¶²é¢æœ€ä½å¤„æ°´å¹³ï¼Œä¸å¯åŠ çƒ­ã€‚</p><h3>3. è¯å“å–ç”¨</h3><p>ä¸‰ä¸åŸåˆ™ï¼šä¸è§¦ã€ä¸å°ã€ä¸å‡‘è¿‘é—»ã€‚</p>`},
            {id:2, t:"Unit 2 æˆ‘ä»¬å‘¨å›´çš„ç©ºæ°”", c:`<h3>1. ç©ºæ°”æˆåˆ†</h3><p>Nâ‚‚ 78%, Oâ‚‚ 21%, ç¨€æœ‰æ°”ä½“ 0.94%ã€‚</p><h3>2. æ°§æ°”æ€§è´¨</h3><p>é“ä¸ç‡ƒçƒ§ï¼š<span class="highlight">ç«æ˜Ÿå››å°„</span>ï¼Œç”Ÿæˆé»‘å›ºã€‚ç“¶åº•æ”¾æ°´ã€‚</p><h3>3. åˆ¶å–æ°§æ°”</h3><p>é«˜é”°é…¸é’¾(åŠ çƒ­)ï¼›è¿‡æ°§åŒ–æ°¢(å‚¬åŒ–å‰‚)ã€‚</p>`},
            {id:3, t:"Unit 3 ç‰©è´¨æ„æˆçš„å¥¥ç§˜", c:`<h3>1. å¾®è§‚ç²’å­</h3><p><strong>åˆ†å­</strong>ï¼šä¿æŒåŒ–å­¦æ€§è´¨ã€‚<br><strong>åŸå­</strong>ï¼šåŒ–å­¦å˜åŒ–æœ€å°ç²’å­ã€‚</p><h3>2. ç»“æ„</h3><p>åŸå­ = è´¨å­ + ä¸­å­ + ç”µå­ã€‚<br><span class="highlight">è´¨å­æ•°å†³å®šå…ƒç´ ç§ç±»</span>ã€‚</p>`},
            {id:4, t:"Unit 4 è‡ªç„¶ç•Œçš„æ°´", c:`<h3>1. ç”µè§£æ°´</h3><p>æ­£æ°§è´Ÿæ°¢ï¼Œä½“ç§¯æ¯” 1:2ã€‚<br>ç»“è®ºï¼šæ°´ç”±Hã€Oå…ƒç´ ç»„æˆã€‚</p><h3>2. å‡€åŒ–</h3><p>æ²‰æ·€â†’è¿‡æ»¤â†’å¸é™„â†’è’¸é¦(æœ€çº¯)ã€‚</p><h3>3. ç¡¬æ°´</h3><p>åŠ è‚¥çš‚æ°´ï¼Œæ³¡æ²«å°‘æµ®æ¸£å¤šã€‚</p>`},
            {id:5, t:"Unit 5 åŒ–å­¦æ–¹ç¨‹å¼", c:`<h3>1. è´¨é‡å®ˆæ’</h3><p>å‚åŠ ååº”è´¨é‡æ€»å’Œ = ç”Ÿæˆè´¨é‡æ€»å’Œã€‚<br>å¾®è§‚ï¼šåŸå­ç§ç±»ã€æ•°ç›®ã€è´¨é‡ä¸å˜ã€‚</p><h3>2. ä¹¦å†™</h3><p>å¿…é¡»é…å¹³ï¼Œæ ‡æ³¨æ¡ä»¶å’ŒçŠ¶æ€ã€‚</p>`},
            {id:6, t:"Unit 6 ç¢³å’Œæ°§åŒ–ç‰©", c:`<h3>1. ç¢³å•è´¨</h3><p>é‡‘åˆšçŸ³(ç¡¬)ã€çŸ³å¢¨(å¯¼ç”µ)ã€‚<br>ç»“æ„ä¸åŒå¯¼è‡´æ€§è´¨å·®å¼‚ã€‚</p><h3>2. COâ‚‚ ä¸ CO</h3><p>COâ‚‚ï¼šç­ç«ã€æ¸©å®¤æ•ˆåº”ã€‚<br>COï¼šæœ‰æ¯’ã€å¯ç‡ƒã€è¿˜åŸæ€§ã€‚</p>`}
        ];

        // é¢˜åº“åŸºç¡€ (å¤åˆ¶ä»¥æ¨¡æ‹Ÿæµ·é‡)
        const Q_BASE = [
            {u:1,q:"å±äºåŒ–å­¦å˜åŒ–çš„æ˜¯ï¼Ÿ",o:["æ¹¿è¡£æ™¾å¹²","çŸ³èœ¡ç†”åŒ–","é£Ÿç‰©è…è´¥","èƒ†çŸ¾ç ”ç¢"],a:2,r:"è…è´¥ç”Ÿæˆæ–°ç‰©è´¨ã€‚"},
            {u:1,q:"èƒ½ç›´æ¥åŠ çƒ­çš„ä»ªå™¨ï¼Ÿ",o:["çƒ§æ¯","è¯•ç®¡","é‡ç­’","é›†æ°”ç“¶"],a:1,r:"è¯•ç®¡å¯ç›´æ¥åŠ çƒ­ã€‚"},
            {u:2,q:"ç©ºæ°”ä¸­å«é‡æœ€å¤šçš„æ°”ä½“ï¼Ÿ",o:["Oâ‚‚","Nâ‚‚","COâ‚‚","He"],a:1,r:"æ°®æ°”78%ã€‚"},
            {u:2,q:"é“ä¸åœ¨æ°§æ°”ä¸­ç‡ƒçƒ§ç°è±¡ï¼Ÿ",o:["ç™½å…‰","è“ç´«ç«","ç«æ˜Ÿå››å°„","ç™½çƒŸ"],a:2,r:"ç”ŸæˆFe3O4ã€‚"},
            {u:3,q:"å†³å®šå…ƒç´ ç§ç±»çš„æ˜¯ï¼Ÿ",o:["è´¨å­æ•°","ä¸­å­æ•°","ç”µå­æ•°","è´¨é‡"],a:0,r:"è´¨å­æ•°ã€‚"},
            {u:3,q:"ä¿æŒæ°´çš„åŒ–å­¦æ€§è´¨çš„ç²’å­ï¼Ÿ",o:["HåŸå­","OåŸå­","æ°´åˆ†å­","Hå…ƒç´ "],a:2,r:"åˆ†å­ä¿æŒåŒ–å­¦æ€§è´¨ã€‚"},
            {u:4,q:"ç”µè§£æ°´æ­£è´Ÿæä½“ç§¯æ¯”ï¼Ÿ",o:["1:2","2:1","1:8","8:1"],a:0,r:"æ­£æ°§è´Ÿæ°¢ 1:2ã€‚"},
            {u:4,q:"å‡€åŒ–ç¨‹åº¦æœ€é«˜çš„æ“ä½œï¼Ÿ",o:["è¿‡æ»¤","æ²‰æ·€","å¸é™„","è’¸é¦"],a:3,r:"è’¸é¦å¾—çº¯æ°´ã€‚"},
            {u:5,q:"åŒ–å­¦ååº”å‰åè‚¯å®šå˜çš„æ˜¯ï¼Ÿ",o:["åŸå­æ•°","å…ƒç´ ç§ç±»","ç‰©è´¨ç§ç±»","æ€»è´¨é‡"],a:2,r:"ç”Ÿæˆæ–°ç‰©è´¨ã€‚"},
            {u:6,q:"é‡‘åˆšçŸ³çŸ³å¢¨æ€§è´¨å·®å¼‚åŸå› ï¼Ÿ",o:["åŸå­å¤§å°","åŸå­æ’åˆ—","åŸå­ç§ç±»","ç”µå­æ•°"],a:1,r:"ç»“æ„å†³å®šæ€§è´¨ã€‚"},
            {u:6,q:"èƒ½ä½¿çŸ³ç°æ°´å˜æµ‘æµŠçš„æ°”ä½“ï¼Ÿ",o:["Oâ‚‚","CO","COâ‚‚","Nâ‚‚"],a:2,r:"COâ‚‚ç‰¹æ€§ã€‚"},
            {u:2,q:"å®éªŒå®¤åˆ¶æ°§æ°”ä¸å¯ç”¨ï¼Ÿ",o:["é«˜é”°é…¸é’¾","è¿‡æ°§åŒ–æ°¢","æ°¯é…¸é’¾","å¤§ç†çŸ³"],a:3,r:"å¤§ç†çŸ³åˆ¶COâ‚‚ã€‚"},
            {u:4,q:"åŒºåˆ«ç¡¬è½¯æ°´ï¼Ÿ",o:["è‚¥çš‚æ°´","é£Ÿç›æ°´","çŸ³ç°æ°´","é…šé…"],a:0,r:"æ³¡æ²«å¤šä¸ºè½¯æ°´ã€‚"},
            {u:6,q:"é™¤å»COâ‚‚ä¸­å°‘é‡COï¼Ÿ",o:["ç‚¹ç‡ƒ","é€šå…¥æ°´","ç¼çƒ­CuO","çŸ³ç°æ°´"],a:2,r:"COè¿˜åŸCuOã€‚"}
        ];
        let FULL_Q_BANK = [];
        for(let i=0; i<8; i++) FULL_Q_BANK = FULL_Q_BANK.concat(Q_BASE); // æ‰©å……åˆ°100+

        // ================= 2. é¡µé¢å¯¼èˆªé€»è¾‘ =================

        function goHome() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('p-home').classList.add('active');
            
            document.getElementById('navTitle').innerText = "ä¹å¹´çº§åŒ–å­¦åŠ©æ‰‹";
            document.getElementById('backBtn').style.display = "none";
            document.getElementById('exitBtn').style.display = "flex";
            
            stopGame();
        }

        function switchPage(pid, title) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pid).classList.add('active');
            
            document.getElementById('navTitle').innerText = title;
            document.getElementById('backBtn').style.display = "flex";
            document.getElementById('exitBtn').style.display = "none";
            
            window.scrollTo(0,0);
        }

        // --- æ¸²æŸ“é€»è¾‘ ---
        
        function openUnits() {
            const container = document.getElementById('unit-list-wrapper');
            container.innerHTML = UNIT_DB.map(u => `
                <div class="list-cell" onclick="showDetail(${u.id})">
                    <div class="cell-icon" style="background:#5856D6;">${u.id}</div>
                    <div class="cell-content">
                        <div class="cell-title">${u.t.split(' ')[2]}</div>
                        <div class="cell-sub">${u.t.split(' ')[0]} ${u.t.split(' ')[1]}</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color:#C7C7CC;"></i>
                </div>
            `).join('');
            
            // é¢„åŠ è½½æµ‹éªŒå•å…ƒæŒ‰é’®
            document.getElementById('quiz-unit-grid').innerHTML = UNIT_DB.map(u => `
                <div class="app-card" onclick="startQuiz(${u.id})" style="padding:12px; box-shadow:none; border:1px solid #E5E5EA;">
                    <h3 style="font-size:14px;">${u.t.split(' ')[0]}</h3>
                    <span style="font-size:12px;">${u.t.split(' ')[2]}</span>
                </div>
            `).join('');
            
            switchPage('p-units', 'å•å…ƒåˆ—è¡¨');
        }

        function showDetail(id) {
            const u = UNIT_DB.find(x => x.id === id);
            document.getElementById('detail-content').innerHTML = u.c;
            switchPage('p-detail', u.t);
        }

        function renderPT() {
            document.getElementById('pt-list').innerHTML = GAME_DATA.element.map((e,i) => `
                <div class="pt-row">
                    <div class="pt-num">${i+1}</div>
                    <div class="pt-sym">${e.s}</div>
                    <div class="pt-name">${e.n}</div>
                </div>
            `).join('');
        }

        function renderFormulas() {
            document.getElementById('formula-list').innerHTML = GAME_DATA.formula.map(f => `
                <div class="list-cell" style="border-radius:16px; margin-bottom:10px; border:none;">
                    <div class="cell-title" style="font-family:monospace; font-size:18px; color:#007AFF;">${f.s}</div>
                    <div class="cell-content" style="text-align:right; color:#8E8E93;">${f.n}</div>
                </div>
            `).join('');
        }


        // ================= 3. æ¸¸æˆé€»è¾‘ =================
        let gameState = { active: false, type: '', score: 0, streak: 0, curr: null };

        function startGame(type) {
            gameState = { active: true, type: type, score: 0, streak: 0, curr: null };
            switchPage('p-game', type === 'element' ? 'å…ƒç´ è®°å¿†' : 'å…¬å¼èƒŒè¯µ');
            nextGameRound();
        }
        
        function stopGame() { gameState.active = false; }

        function nextGameRound() {
            if(!gameState.active) return;
            const db = gameState.type === 'element' ? GAME_DATA.element : GAME_DATA.formula;
            const correct = db[Math.floor(Math.random() * db.length)];
            gameState.curr = correct;

            document.getElementById('g-card').innerText = correct.s;
            document.getElementById('g-score').innerText = gameState.score;
            document.getElementById('g-streak').innerText = gameState.streak;
            document.getElementById('g-msg').innerText = "";

            // å¹²æ‰°é¡¹
            let opts = [correct];
            while(opts.length < 4) {
                let r = db[Math.floor(Math.random() * db.length)];
                if(!opts.includes(r)) opts.push(r);
            }
            opts.sort(() => 0.5 - Math.random());

            document.getElementById('g-opts').innerHTML = opts.map(o => `
                <button class="option-btn" onclick="checkGame(this, '${o.n}')">${o.n}</button>
            `).join('');
        }

        function checkGame(el, ans) {
            if(!gameState.active) return;
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.onclick = null); // é”æ­»

            if(ans === gameState.curr.n) {
                el.classList.add('correct');
                gameState.score += 10 + (gameState.streak * 2);
                gameState.streak++;
                document.getElementById('g-msg').innerText = "æ­£ç¡®! +Score";
                setTimeout(nextGameRound, 600);
            } else {
                el.classList.add('wrong');
                btns.forEach(b => { if(b.innerText === gameState.curr.n) b.classList.add('correct'); });
                gameState.streak = 0;
                document.getElementById('g-msg').innerText = "æ­£ç¡®ç­”æ¡ˆ: " + gameState.curr.n;
                setTimeout(nextGameRound, 1500);
            }
        }

        // ================= 4. æµ‹éªŒé€»è¾‘ =================
        let quiz = { list: [], idx: 0, score: 0 };

        function startQuiz(mode) {
            let list = [];
            if(mode === 'full') {
                list = FULL_Q_BANK.sort(() => 0.5 - Math.random()).slice(0, 20);
                document.getElementById('q-tag').innerText = "ç»¼åˆå·";
            } else {
                let raw = FULL_Q_BANK.filter(q => q.u === mode);
                if(raw.length < 10) raw = raw.concat(raw); 
                list = raw.sort(() => 0.5 - Math.random()).slice(0, 15);
                document.getElementById('q-tag').innerText = "å•å…ƒå·";
            }
            quiz = { list: list, idx: 0, score: 0 };
            switchPage('p-quiz-run', 'è€ƒè¯•è¿›è¡Œä¸­');
            renderQ();
        }

        function renderQ() {
            if(quiz.idx >= quiz.list.length) {
                showRes();
                return;
            }
            const q = quiz.list[quiz.idx];
            const pct = ((quiz.idx + 1) / quiz.list.length) * 100;
            document.getElementById('q-bar').style.width = pct + "%";
            document.getElementById('q-count').innerText = `${quiz.idx+1}/${quiz.list.length}`;
            document.getElementById('q-text').innerText = q.q;

            document.getElementById('q-opts').innerHTML = q.o.map((opt, i) => `
                <div class="option-btn" onclick="checkQ(this, ${i})" style="display:flex; gap:10px; text-align:left; align-items:center;">
                    <span style="color:var(--primary); font-weight:bold;">${['A','B','C','D'][i]}.</span>
                    <span>${opt}</span>
                </div>
            `).join('');

            document.getElementById('q-feedback').style.display = 'none';
            document.getElementById('q-next').style.display = 'none';
        }

        function checkQ(el, i) {
            const opts = document.querySelectorAll('.option-btn');
            opts.forEach(o => o.onclick = null);

            const q = quiz.list[quiz.idx];
            if(i === q.a) {
                el.classList.add('correct');
                quiz.score++;
            } else {
                el.classList.add('wrong');
                opts[q.a].classList.add('correct');
            }

            const fb = document.getElementById('q-feedback');
            fb.style.display = 'block';
            fb.innerHTML = `<strong>è§£æï¼š</strong>${q.r}`;
            document.getElementById('q-next').style.display = 'block';
            
            window.scrollTo(0, document.body.scrollHeight);
        }

        function nextQ() {
            quiz.idx++;
            renderQ();
            window.scrollTo(0,0);
        }

        function showRes() {
            const s = Math.round((quiz.score / quiz.list.length) * 100);
            document.getElementById('res-score').innerText = s;
            switchPage('p-result', 'æˆç»©å•');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            openUnits(); // é¢„åŠ è½½åˆ—è¡¨é˜²æ­¢ç‚¹å‡»ç©ºç™½
            goHome();
        });

    </script>
</body>
</html>