<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆä¸­æ•°å­¦æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
        }
        
        .admin-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .tab.active {
            border-bottom-color: #4CAF50;
            background: white;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
        }
        
        .tab-content.active {
            display: block;
        }

        .stats { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px; 
            background: #f8f9fa; 
            padding: 15px; 
        }
        .stat-item { 
            text-align: center; 
            padding: 10px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .stat-value { 
            font-size: 20px; 
            font-weight: bold; 
            color: #4CAF50; 
        }
        .question-container { 
            padding: 20px; 
        }
        .question { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            border-left: 5px solid #4CAF50; 
        }
        .question-number { 
            color: #666; 
            font-size: 12px; 
            margin-bottom: 8px; 
        }
        .question-text { 
            font-size: 16px; 
            line-height: 1.5; 
            margin-bottom: 15px; 
        }
        .options-container { 
            display: grid; 
            gap: 8px; 
            margin-bottom: 15px; 
        }
        .option { 
            padding: 12px; 
            background: white; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
        }
        .option:hover { 
            border-color: #4CAF50; 
            background: #f1f8e9; 
        }
        .option.correct { 
            background: #c8e6c9; 
            border-color: #4CAF50; 
        }
        .option.wrong { 
            background: #ffcdd2; 
            border-color: #f44336; 
        }
        .controls { 
            display: flex; 
            justify-content: space-between; 
            padding: 15px; 
            background: #f8f9fa; 
            border-top: 1px solid #ddd; 
            gap: 10px; 
        }
        button { 
            padding: 10px 15px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px; 
            transition: all 0.3s ease; 
        }
        .btn-primary { 
            background: #4CAF50; 
            color: white; 
        }
        .btn-primary:hover { 
            background: #45a049; 
        }
        .btn-secondary { 
            background: #2196F3; 
            color: white; 
        }
        .btn-secondary:hover { 
            background: #1976D2; 
        }
        .btn-warning { 
            background: #ff9800; 
            color: white; 
        }
        .btn-warning:hover { 
            background: #f57c00; 
        }
        .btn-danger { 
            background: #f44336; 
            color: white; 
        }
        .btn-danger:hover { 
            background: #d32f2f; 
        }
        .explanation { 
            background: #e3f2fd; 
            padding: 12px; 
            border-radius: 8px; 
            margin-top: 12px; 
            display: none; 
            font-size: 13px; 
        }
        .knowledge-tag { 
            display: inline-block; 
            background: #ff9800; 
            color: white; 
            padding: 3px 6px; 
            border-radius: 4px; 
            font-size: 11px; 
            margin-top: 8px; 
        }
        .progress-bar { 
            width: 100%; 
            height: 6px; 
            background: #e0e0e0; 
            border-radius: 3px; 
            margin-bottom: 12px; 
            overflow: hidden; 
        }
        .progress { 
            height: 100%; 
            background: #4CAF50; 
            width: 0%; 
            transition: width 0.3s ease; 
        }
        .chapter-list { 
            display: grid; 
            gap: 10px; 
            margin-top: 15px; 
        }
        .chapter-item { 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 8px; 
            cursor: pointer; 
            border-left: 4px solid #4CAF50; 
        }
        .report-item { 
            padding: 10px; 
            background: white; 
            border-radius: 8px; 
            margin-bottom: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .wrong-questions-list { 
            max-height: 300px; 
            overflow-y: auto; 
        }
        .wrong-question-item { 
            padding: 10px; 
            background: #fff3cd; 
            border-radius: 6px; 
            margin-bottom: 8px; 
            border-left: 3px solid #ffc107; 
        }

        /* ç®¡ç†å‘˜é¢æ¿æ ·å¼ */
        .admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .admin-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .admin-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 10px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .question-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #2196F3;
        }
        
        @media (min-width: 768px) {
            body { 
                padding: 20px; 
                font-size: 16px; 
            }
            .container { 
                max-width: 800px; 
            }
            .stats { 
                grid-template-columns: repeat(4, 1fr); 
            }
            .admin-panel { 
                max-width: 600px; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§® åˆä¸­æ•°å­¦æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ</h1>
            <p>å·©å›ºåŸºç¡€ Â· æå‡èƒ½åŠ› Â· å¤‡æˆ˜ä¸­è€ƒ</p>
            <button class="admin-btn" onclick="showAdminPanel()">é¢˜ç›®ç®¡ç†</button>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('practice')">åˆ·é¢˜ç»ƒä¹ </div>
            <div class="tab" onclick="switchTab('chapters')">ç« èŠ‚åˆ†ç±»</div>
            <div class="tab" onclick="switchTab('report')">æˆç»©æŠ¥å‘Š</div>
            <div class="tab" onclick="switchTab('wrong')">é”™é¢˜é‡åš</div>
        </div>
        
        <!-- åˆ·é¢˜ç»ƒä¹ æ ‡ç­¾ -->
        <div id="practice" class="tab-content active">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="score">0</div>
                    <div>å¾—åˆ†</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="correct-count">0</div>
                    <div>æ­£ç¡®</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="wrong-count">0</div>
                    <div>é”™è¯¯</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="progress">1/10</div>
                    <div>è¿›åº¦</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            
            <div class="question-container">
                <div class="question">
                    <div class="question-number" id="question-number">é¢˜ç›® #1</div>
                    <div class="question-text" id="question-text">è¯·ç¨ç­‰ï¼Œé¢˜ç›®åŠ è½½ä¸­...</div>
                    <div class="options-container" id="options-container"></div>
                    <div class="explanation" id="explanation"></div>
                    <div class="knowledge-tag" id="knowledge-tag"></div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-secondary" onclick="showExplanation()">æŸ¥çœ‹è§£æ</button>
                <button class="btn-primary" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
        
        <!-- å…¶ä»–æ ‡ç­¾é¡µ -->
        <div id="chapters" class="tab-content">
            <h3 style="text-align: center; margin: 15px 0;">é€‰æ‹©å­¦ä¹ ç« èŠ‚</h3>
            <div class="chapter-list" id="chapter-list"></div>
        </div>
        
        <div id="report" class="tab-content">
            <h3 style="text-align: center; margin: 15px 0;">å­¦ä¹ åˆ†ææŠ¥å‘Š</h3>
            <div class="report-item">
                <strong>æ€»ä½“è¡¨ç°:</strong>
                <div id="overall-report">æš‚æ— æ•°æ®</div>
            </div>
            <div class="report-item">
                <strong>çŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ:</strong>
                <div id="knowledge-report">æš‚æ— æ•°æ®</div>
            </div>
            <div class="report-item">
                <strong>å»ºè®®:</strong>
                <div id="suggestion">è¯·å…ˆå®Œæˆä¸€äº›é¢˜ç›®</div>
            </div>
            <button class="btn-warning" onclick="saveProgress()" style="margin-top: 15px; width: 100%;">ä¿å­˜è¿›åº¦åˆ°æœ¬åœ°</button>
        </div>
        
        <div id="wrong" class="tab-content">
            <h3 style="text-align: center; margin: 15px 0;">é”™é¢˜æœ¬</h3>
            <div class="wrong-questions-list" id="wrong-questions-list">
                <div style="text-align: center; color: #666; padding: 20px;">æš‚æ— é”™é¢˜ï¼Œç»§ç»­åŠ æ²¹ï¼ğŸ’ª</div>
            </div>
            <button class="btn-warning" onclick="practiceWrongQuestions()" style="margin-top: 15px; width: 100%;">ç»ƒä¹ é”™é¢˜</button>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜é¢æ¿ -->
    <div class="admin-overlay" id="admin-overlay" onclick="hideAdminPanel()"></div>
    <div class="admin-panel" id="admin-panel">
        <h2>ğŸ“š é¢˜ç›®ç®¡ç†</h2>
        
        <div class="admin-section">
            <h3>æ·»åŠ å•ä¸ªé¢˜ç›®</h3>
            <div class="form-group">
                <label>ç« èŠ‚åç§°:</label>
                <input type="text" id="new-chapter" placeholder="ä¾‹å¦‚ï¼šäºŒæ¬¡å‡½æ•°" value="è‡ªå®šä¹‰é¢˜ç›®">
            </div>
            <div class="form-group">
                <label>é¢˜ç›®å†…å®¹:</label>
                <textarea id="new-question" placeholder="è¾“å…¥é¢˜ç›®å†…å®¹..." rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>é€‰é¡¹A:</label>
                <input type="text" id="new-option-a" placeholder="A. é€‰é¡¹å†…å®¹">
            </div>
            <div class="form-group">
                <label>é€‰é¡¹B:</label>
                <input type="text" id="new-option-b" placeholder="B. é€‰é¡¹å†…å®¹">
            </div>
            <div class="form-group">
                <label>é€‰é¡¹C:</label>
                <input type="text" id="new-option-c" placeholder="C. é€‰é¡¹å†…å®¹">
            </div>
            <div class="form-group">
                <label>é€‰é¡¹D:</label>
                <input type="text" id="new-option-d" placeholder="D. é€‰é¡¹å†…å®¹">
            </div>
            <div class="form-group">
                <label>æ­£ç¡®ç­”æ¡ˆ:</label>
                <select id="new-answer">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>
            <div class="form-group">
                <label>é¢˜ç›®è§£æ:</label>
                <textarea id="new-explanation" placeholder="è¾“å…¥é¢˜ç›®è§£æ..." rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>çŸ¥è¯†ç‚¹:</label>
                <input type="text" id="new-knowledge" placeholder="ä¾‹å¦‚ï¼šå‹¾è‚¡å®šç†">
            </div>
            <div class="form-group">
                <label>éš¾åº¦:</label>
                <select id="new-difficulty">
                    <option value="ç®€å•">ç®€å•</option>
                    <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                    <option value="å›°éš¾">å›°éš¾</option>
                </select>
            </div>
            <button class="btn-primary" onclick="addSingleQuestion()">æ·»åŠ é¢˜ç›®</button>
            <button class="btn-secondary" onclick="previewQuestion()">é¢„è§ˆé¢˜ç›®</button>
            
            <div id="question-preview" class="question-preview" style="display: none;">
                <h4>é¢˜ç›®é¢„è§ˆ:</h4>
                <div id="preview-content"></div>
            </div>
        </div>

        <div class="admin-section">
            <h3>é¢˜ç›®ç»Ÿè®¡</h3>
            <div id="question-stats">æ­£åœ¨åŠ è½½...</div>
            <button class="btn-secondary" onclick="exportQuestions()" style="margin-top: 10px;">å¯¼å‡ºé¢˜ç›®åº“</button>
            <button class="btn-danger" onclick="resetQuestions()" style="margin-top: 10px;">é‡ç½®ä¸ºé»˜è®¤é¢˜ç›®</button>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn-warning" onclick="hideAdminPanel()">å…³é—­ç®¡ç†é¢æ¿</button>
        </div>
    </div>

    <script>
        // é»˜è®¤é¢˜ç›®åº“ - å®Œæ•´çš„åˆä¸­æ•°å­¦é¢˜ç›®
        let questionBank = {
            "æœ‰ç†æ•°è¿ç®—": [
                {
                    id: 1,
                    question: "è®¡ç®—ï¼š(-3) + 7 - (-4) = ?",
                    options: ["A. 8", "B. 6", "C. 4", "D. 2"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼š(-3) + 7 = 4ï¼Œ4 - (-4) = 4 + 4 = 8",
                    knowledge: "æœ‰ç†æ•°è¿ç®—",
                    difficulty: "ç®€å•"
                },
                {
                    id: 2,
                    question: "è®¡ç®—ï¼š-5 Ã— (-2) + 3 Ã— (-4) = ?",
                    options: ["A. -2", "B. 2", "C. -22", "D. 22"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼š-5 Ã— (-2) = 10ï¼Œ3 Ã— (-4) = -12ï¼Œ10 + (-12) = -2",
                    knowledge: "æœ‰ç†æ•°è¿ç®—",
                    difficulty: "ç®€å•"
                }
            ],
            "ä¸€æ¬¡å‡½æ•°": [
                {
                    id: 3,
                    question: "ä¸€æ¬¡å‡½æ•° y = 2x - 1 ä¸yè½´çš„äº¤ç‚¹åæ ‡æ˜¯ï¼Ÿ",
                    options: ["A. (0, -1)", "B. (0, 1)", "C. (1, 0)", "D. (-1, 0)"],
                    answer: "A", 
                    explanation: "ğŸ“ è§£æï¼šä»¤ x = 0ï¼Œåˆ™ y = 2Ã—0 - 1 = -1ï¼Œæ‰€ä»¥äº¤ç‚¹ä¸º (0, -1)",
                    knowledge: "ä¸€æ¬¡å‡½æ•°",
                    difficulty: "ç®€å•"
                }
            ],
            "ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹": [
                {
                    id: 4,
                    question: "è§£æ–¹ç¨‹ï¼šxÂ² - 5x + 6 = 0",
                    options: ["A. x=2,3", "B. x=1,6", "C. x=-2,-3", "D. x=-1,-6"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼šå› å¼åˆ†è§£å¾— (x-2)(x-3)=0ï¼Œæ‰€ä»¥ x=2 æˆ– x=3",
                    knowledge: "ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹",
                    difficulty: "ä¸­ç­‰"
                }
            ],
            "å‡ ä½•å›¾å½¢": [
                {
                    id: 5,
                    question: "åœ¨â–³ABCä¸­ï¼Œâˆ A=60Â°, âˆ B=45Â°, é‚£ä¹ˆâˆ Cç­‰äºå¤šå°‘åº¦ï¼Ÿ",
                    options: ["A. 75Â°", "B. 65Â°", "C. 85Â°", "D. 95Â°"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼šä¸‰è§’å½¢å†…è§’å’Œ180Â°ï¼Œâˆ C = 180Â° - 60Â° - 45Â° = 75Â°",
                    knowledge: "ä¸‰è§’å½¢æ€§è´¨",
                    difficulty: "ç®€å•"
                },
                {
                    id: 6,
                    question: "åœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œä¸¤ç›´è§’è¾¹åˆ†åˆ«ä¸º3å’Œ4ï¼Œæ±‚æ–œè¾¹é•¿",
                    options: ["A. 5", "B. 6", "C. 7", "D. 8"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼šå‹¾è‚¡å®šç†ï¼šæ–œè¾¹ = âˆš(3Â²+4Â²) = âˆš(9+16) = âˆš25 = 5",
                    knowledge: "å‹¾è‚¡å®šç†",
                    difficulty: "ç®€å•"
                }
            ],
            "äºŒæ¬¡å‡½æ•°": [
                {
                    id: 7,
                    question: "äºŒæ¬¡å‡½æ•° y = xÂ² - 4x + 3 çš„é¡¶ç‚¹åæ ‡æ˜¯ï¼Ÿ",
                    options: ["A. (2, -1)", "B. (1, 0)", "C. (4, 3)", "D. (-2, 15)"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼šé…æ–¹å¾— y = (x-2)Â² - 1ï¼Œæ‰€ä»¥é¡¶ç‚¹åæ ‡ä¸º (2, -1)",
                    knowledge: "äºŒæ¬¡å‡½æ•°",
                    difficulty: "ä¸­ç­‰"
                }
            ],
            "ä»£æ•°è¿ç®—": [
                {
                    id: 8,
                    question: "åŒ–ç®€ï¼š2(a - 3b) + 3(2a + b) = ?",
                    options: ["A. 8a - 3b", "B. 5a - 2b", "C. 4a + 9b", "D. 6a - 5b"],
                    answer: "A",
                    explanation: "ğŸ“ è§£æï¼š2(a-3b) + 3(2a+b) = 2a-6b+6a+3b = 8a-3b",
                    knowledge: "ä»£æ•°å¼åŒ–ç®€",
                    difficulty: "ç®€å•"
                }
            ]
        };

        // åº”ç”¨çŠ¶æ€ç®¡ç†
        let appState = {
            currentQuestions: [],
            currentQuestionIndex: 0,
            score: 0,
            correctCount: 0,
            wrongCount: 0,
            answered: false,
            wrongQuestions: [],
            practiceHistory: {},
            currentChapter: "all"
        };

        // åˆå§‹åŒ–åº”ç”¨
        function init() {
            loadAllProgress();
            showAllQuestions();
            initChapters();
            updateStats();
            updateProgressBar();
            updateWrongQuestionsList();
            updateQuestionStats();
        }

        // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹å’Œå–æ¶ˆæ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // æ¿€æ´»å½“å‰æ ‡ç­¾
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'report') {
                generateReport();
            }
        }

        // æ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®
        function showAllQuestions() {
            appState.currentQuestions = [];
            Object.values(questionBank).forEach(chapter => {
                appState.currentQuestions.push(...chapter);
            });
            appState.currentChapter = "all";
            appState.currentQuestionIndex = 0;
            showCurrentQuestion();
        }

        // åˆå§‹åŒ–ç« èŠ‚åˆ—è¡¨
        function initChapters() {
            const chapterList = document.getElementById('chapter-list');
            chapterList.innerHTML = '';
            
            // æ·»åŠ "å…¨éƒ¨é¢˜ç›®"é€‰é¡¹
            const allItem = document.createElement('div');
            allItem.className = 'chapter-item';
            allItem.innerHTML = `
                <strong>å…¨éƒ¨é¢˜ç›®</strong>
                <div style="color: #666; font-size: 12px; margin-top: 5px;">${getTotalQuestions()} é“é¢˜</div>
            `;
            allItem.onclick = () => {
                showAllQuestions();
                switchTab('practice');
            };
            chapterList.appendChild(allItem);
            
            // æ·»åŠ å„ç« èŠ‚
            Object.entries(questionBank).forEach(([chapterName, questions]) => {
                const chapterItem = document.createElement('div');
                chapterItem.className = 'chapter-item';
                chapterItem.innerHTML = `
                    <strong>${chapterName}</strong>
                    <div style="color: #666; font-size: 12px; margin-top: 5px;">${questions.length} é“é¢˜</div>
                `;
                chapterItem.onclick = () => {
                    startChapterPractice(chapterName);
                    switchTab('practice');
                };
                chapterList.appendChild(chapterItem);
            });
        }

        function getTotalQuestions() {
            return Object.values(questionBank).reduce((total, chapter) => total + chapter.length, 0);
        }

        // å¼€å§‹ç« èŠ‚ç»ƒä¹ 
        function startChapterPractice(chapterName) {
            appState.currentChapter = chapterName;
            appState.currentQuestions = [...questionBank[chapterName]];
            appState.currentQuestionIndex = 0;
            showCurrentQuestion();
        }

        // æ˜¾ç¤ºå½“å‰é¢˜ç›®
        function showCurrentQuestion() {
            if (appState.currentQuestions.length === 0) {
                document.getElementById('question-text').textContent = 'æš‚æ— é¢˜ç›®ï¼Œè¯·æ·»åŠ é¢˜ç›®';
                return;
            }
            
            const q = appState.currentQuestions[appState.currentQuestionIndex];
            document.getElementById('question-number').textContent = 
                `é¢˜ç›® #${appState.currentQuestionIndex + 1} Â· ${q.difficulty} Â· ${appState.currentChapter === 'all' ? q.knowledge : appState.currentChapter}`;
            document.getElementById('question-text').textContent = q.question;
            document.getElementById('knowledge-tag').textContent = `çŸ¥è¯†ç‚¹ï¼š${q.knowledge}`;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            q.options.forEach((option) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.textContent = option;
                div.onclick = () => checkAnswer(option[0]);
                optionsContainer.appendChild(div);
            });
            
            document.getElementById('explanation').style.display = 'none';
            appState.answered = false;
            
            updateStats();
            updateProgressBar();
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(selected) {
            if (appState.answered) return;
            
            appState.answered = true;
            const q = appState.currentQuestions[appState.currentQuestionIndex];
            const correctAnswer = q.answer;
            const options = document.querySelectorAll('.option');
            
            let isCorrect = false;
            
            options.forEach(opt => {
                if (opt.textContent[0] === correctAnswer) {
                    opt.classList.add('correct');
                }
                if (opt.textContent[0] === selected) {
                    if (selected === correctAnswer) {
                        opt.classList.add('correct');
                        isCorrect = true;
                        appState.score += 10;
                        appState.correctCount++;
                    } else {
                        opt.classList.add('wrong');
                        appState.wrongCount++;
                        // æ·»åŠ åˆ°é”™é¢˜æœ¬
                        if (!appState.wrongQuestions.some(wq => wq.id === q.id)) {
                            appState.wrongQuestions.push({...q, userAnswer: selected});
                        }
                    }
                }
            });
            
            // è®°å½•ç»ƒä¹ å†å²
            if (!appState.practiceHistory[appState.currentChapter]) {
                appState.practiceHistory[appState.currentChapter] = [];
            }
            appState.practiceHistory[appState.currentChapter].push({
                questionId: q.id,
                isCorrect: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            updateStats();
            updateWrongQuestionsList();
            saveAllProgress();
            
            // è‡ªåŠ¨æ˜¾ç¤ºè§£æ
            setTimeout(() => {
                showExplanation();
            }, 1000);
        }

        // æ˜¾ç¤ºè§£æ
        function showExplanation() {
            const explanation = document.getElementById('explanation');
            const q = appState.currentQuestions[appState.currentQuestionIndex];
            explanation.textContent = q.explanation;
            explanation.style.display = 'block';
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            appState.currentQuestionIndex = (appState.currentQuestionIndex + 1) % appState.currentQuestions.length;
            showCurrentQuestion();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('score').textContent = appState.score;
            document.getElementById('correct-count').textContent = appState.correctCount;
            document.getElementById('wrong-count').textContent = appState.wrongCount;
            document.getElementById('progress').textContent = 
                `${appState.currentQuestionIndex + 1}/${appState.currentQuestions.length}`;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const progress = appState.currentQuestions.length > 0 ? 
                ((appState.currentQuestionIndex + 1) / appState.currentQuestions.length) * 100 : 0;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        // æ›´æ–°é”™é¢˜åˆ—è¡¨
        function updateWrongQuestionsList() {
            const wrongList = document.getElementById('wrong-questions-list');
            
            if (appState.wrongQuestions.length === 0) {
                wrongList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">æš‚æ— é”™é¢˜ï¼Œç»§ç»­åŠ æ²¹ï¼ğŸ’ª</div>';
                return;
            }
            
            wrongList.innerHTML = '';
            appState.wrongQuestions.forEach((q, index) => {
                const item = document.createElement('div');
                item.className = 'wrong-question-item';
                item.innerHTML = `
                    <div><strong>${index + 1}. ${q.question}</strong></div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">ä½ çš„ç­”æ¡ˆ: ${q.userAnswer} | æ­£ç¡®ç­”æ¡ˆ: ${q.answer}</div>
                    <div style="font-size: 11px; color: #ff9800; margin-top: 3px;">${q.knowledge}</div>
                `;
                wrongList.appendChild(item);
            });
        }

        // ç»ƒä¹ é”™é¢˜
        function practiceWrongQuestions() {
            if (appState.wrongQuestions.length === 0) {
                alert('æš‚æ— é”™é¢˜å¯ä»¥ç»ƒä¹ ï¼');
                return;
            }
            
            appState.currentChapter = 'wrong';
            appState.currentQuestions = [...appState.wrongQuestions];
            appState.currentQuestionIndex = 0;
            showCurrentQuestion();
            switchTab('practice');
        }

        // ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
        function generateReport() {
            const totalQuestions = appState.correctCount + appState.wrongCount;
            
            if (totalQuestions === 0) {
                document.getElementById('overall-report').textContent = 'è¯·å…ˆå®Œæˆä¸€äº›é¢˜ç›®';
                document.getElementById('knowledge-report').textContent = 'æš‚æ— æ•°æ®';
                document.getElementById('suggestion').textContent = 'å¼€å§‹åˆ·é¢˜å§ï¼';
                return;
            }
            
            const accuracy = Math.round((appState.correctCount / totalQuestions) * 100);
            
            // æ€»ä½“æŠ¥å‘Š
            document.getElementById('overall-report').innerHTML = `
                <div>å®Œæˆé¢˜ç›®: ${totalQuestions} é“</div>
                <div>æ­£ç¡®ç‡: ${accuracy}%</div>
                <div>ç´¯è®¡å¾—åˆ†: ${appState.score} åˆ†</div>
            `;
            
            // çŸ¥è¯†ç‚¹æŠ¥å‘Š
            const knowledgeStats = {};
            Object.values(appState.practiceHistory).flat().forEach(record => {
                const question = findQuestionById(record.questionId);
                if (question) {
                    if (!knowledgeStats[question.knowledge]) {
                        knowledgeStats[question.knowledge] = { total: 0, correct: 0 };
                    }
                    knowledgeStats[question.knowledge].total++;
                    if (record.isCorrect) knowledgeStats[question.knowledge].correct++;
                }
            });
            
            let knowledgeHTML = '';
            Object.entries(knowledgeStats).forEach(([knowledge, stats]) => {
                const knowledgeAccuracy = Math.round((stats.correct / stats.total) * 100);
                knowledgeHTML += `<div>${knowledge}: ${knowledgeAccuracy}% (${stats.correct}/${stats.total})</div>`;
            });
            document.getElementById('knowledge-report').innerHTML = knowledgeHTML || 'æš‚æ— æ•°æ®';
            
            // å­¦ä¹ å»ºè®®
            let suggestion = '';
            if (accuracy >= 80) {
                suggestion = 'ğŸ‘ è¡¨ç°ä¼˜ç§€ï¼å¯ä»¥æŒ‘æˆ˜æ›´é«˜éš¾åº¦çš„é¢˜ç›®';
            } else if (accuracy >= 60) {
                suggestion = 'ğŸ’ª è¡¨ç°è‰¯å¥½ï¼Œå»ºè®®é‡ç‚¹å¤ä¹ é”™é¢˜';
            } else {
                suggestion = 'ğŸ“š éœ€è¦åŠ å¼ºåŸºç¡€ï¼Œå»ºè®®ä»ç®€å•é¢˜ç›®å¼€å§‹';
            }
            document.getElementById('suggestion').textContent = suggestion;
        }

        // æ ¹æ®IDæŸ¥æ‰¾é¢˜ç›®
        function findQuestionById(id) {
            for (const chapter of Object.values(questionBank)) {
                const question = chapter.find(q => q.id === id);
                if (question) return question;
            }
            return null;
        }

        // ç®¡ç†å‘˜é¢æ¿åŠŸèƒ½
        function showAdminPanel() {
            document.getElementById('admin-overlay').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'block';
            updateQuestionStats();
        }

        function hideAdminPanel() {
            document.getElementById('admin-overlay').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'none';
        }

        function previewQuestion() {
            const chapter = document.getElementById('new-chapter').value || 'è‡ªå®šä¹‰é¢˜ç›®';
            const question = document.getElementById('new-question').value;
            const options = [
                document.getElementById('new-option-a').value,
                document.getElementById('new-option-b').value,
                document.getElementById('new-option-c').value,
                document.getElementById('new-option-d').value
            ];
            const answer = document.getElementById('new-answer').value;
            const explanation = document.getElementById('new-explanation').value;
            const knowledge = document.getElementById('new-knowledge').value;
            const difficulty = document.getElementById('new-difficulty').value;

            if (!question || options.some(opt => !opt)) {
                alert('è¯·å¡«å†™å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼');
                return;
            }

            const previewContent = document.getElementById('preview-content');
            previewContent.innerHTML = `
                <strong>${question}</strong><br>
                ${options.map(opt => `<div>${opt}</div>`).join('')}
                <br>æ­£ç¡®ç­”æ¡ˆ: ${answer}<br>
                è§£æ: ${explanation}<br>
                çŸ¥è¯†ç‚¹: ${knowledge}<br>
                éš¾åº¦: ${difficulty}<br>
                ç« èŠ‚: ${chapter}
            `;
            document.getElementById('question-preview').style.display = 'block';
        }

        function addSingleQuestion() {
            const chapter = document.getElementById('new-chapter').value || 'è‡ªå®šä¹‰é¢˜ç›®';
            const question = document.getElementById('new-question').value;
            const options = [
                document.getElementById('new-option-a').value,
                document.getElementById('new-option-b').value,
                document.getElementById('new-option-c').value,
                document.getElementById('new-option-d').value
            ];
            const answer = document.getElementById('new-answer').value;
            const explanation = document.getElementById('new-explanation').value;
            const knowledge = document.getElementById('new-knowledge').value;
            const difficulty = document.getElementById('new-difficulty').value;

            // éªŒè¯è¾“å…¥
            if (!question || options.some(opt => !opt) || !explanation || !knowledge) {
                alert('è¯·å¡«å†™å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼');
                return;
            }

            // ç”Ÿæˆæ–°ID
            const newId = generateNewId();

            // åˆ›å»ºæ–°é¢˜ç›®
            const newQuestion = {
                id: newId,
                question: question,
                options: options,
                answer: answer,
                explanation: explanation,
                knowledge: knowledge,
                difficulty: difficulty
            };

            // æ·»åŠ åˆ°é¢˜åº“
            if (!questionBank[chapter]) {
                questionBank[chapter] = [];
            }
            questionBank[chapter].push(newQuestion);

            // æ¸…ç©ºè¡¨å•
            clearForm();
            
            // æ›´æ–°ç•Œé¢
            updateQuestionStats();
            initChapters();
            saveAllProgress();
            
            alert('é¢˜ç›®æ·»åŠ æˆåŠŸï¼');
        }

        function generateNewId() {
            let maxId = 0;
            Object.values(questionBank).forEach(chapter => {
                chapter.forEach(q => {
                    if (q.id > maxId) maxId = q.id;
                });
            });
            return maxId + 1;
        }

        function clearForm() {
            document.getElementById('new-question').value = '';
            document.getElementById('new-option-a').value = '';
            document.getElementById('new-option-b').value = '';
            document.getElementById('new-option-c').value = '';
            document.getElementById('new-option-d').value = '';
            document.getElementById('new-explanation').value = '';
            document.getElementById('new-knowledge').value = '';
            document.getElementById('question-preview').style.display = 'none';
        }

        function updateQuestionStats() {
            let totalQuestions = 0;
            let chaptersInfo = [];
            
            Object.entries(questionBank).forEach(([chapter, questions]) => {
                totalQuestions += questions.length;
                chaptersInfo.push(`${chapter}: ${questions.length}é¢˜`);
            });

            document.getElementById('question-stats').innerHTML = `
                <div>æ€»é¢˜ç›®æ•°: ${totalQuestions}</div>
                <div>ç« èŠ‚æ•°: ${Object.keys(questionBank).length}</div>
                <div>ç« èŠ‚åˆ†å¸ƒ: ${chaptersInfo.join(', ')}</div>
            `;
        }

        function exportQuestions() {
            const dataStr = JSON.stringify(questionBank, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'math_questions_backup.json';
            link.click();
        }

        function resetQuestions() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤é¢˜ç›®å—ï¼Ÿè¿™ä¼šåˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰é¢˜ç›®ï¼')) {
                // é‡æ–°åˆå§‹åŒ–é»˜è®¤é¢˜ç›®
                questionBank = {
                    "æœ‰ç†æ•°è¿ç®—": [
                        {
                            id: 1,
                            question: "è®¡ç®—ï¼š(-3) + 7 - (-4) = ?",
                            options: ["A. 8", "B. 6", "C. 4", "D. 2"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼š(-3) + 7 = 4ï¼Œ4 - (-4) = 4 + 4 = 8",
                            knowledge: "æœ‰ç†æ•°è¿ç®—",
                            difficulty: "ç®€å•"
                        },
                        {
                            id: 2,
                            question: "è®¡ç®—ï¼š-5 Ã— (-2) + 3 Ã— (-4) = ?",
                            options: ["A. -2", "B. 2", "C. -22", "D. 22"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼š-5 Ã— (-2) = 10ï¼Œ3 Ã— (-4) = -12ï¼Œ10 + (-12) = -2",
                            knowledge: "æœ‰ç†æ•°è¿ç®—",
                            difficulty: "ç®€å•"
                        }
                    ],
                    "ä¸€æ¬¡å‡½æ•°": [
                        {
                            id: 3,
                            question: "ä¸€æ¬¡å‡½æ•° y = 2x - 1 ä¸yè½´çš„äº¤ç‚¹åæ ‡æ˜¯ï¼Ÿ",
                            options: ["A. (0, -1)", "B. (0, 1)", "C. (1, 0)", "D. (-1, 0)"],
                            answer: "A", 
                            explanation: "ğŸ“ è§£æï¼šä»¤ x = 0ï¼Œåˆ™ y = 2Ã—0 - 1 = -1ï¼Œæ‰€ä»¥äº¤ç‚¹ä¸º (0, -1)",
                            knowledge: "ä¸€æ¬¡å‡½æ•°",
                            difficulty: "ç®€å•"
                        }
                    ],
                    "ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹": [
                        {
                            id: 4,
                            question: "è§£æ–¹ç¨‹ï¼šxÂ² - 5x + 6 = 0",
                            options: ["A. x=2,3", "B. x=1,6", "C. x=-2,-3", "D. x=-1,-6"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼šå› å¼åˆ†è§£å¾— (x-2)(x-3)=0ï¼Œæ‰€ä»¥ x=2 æˆ– x=3",
                            knowledge: "ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹",
                            difficulty: "ä¸­ç­‰"
                        }
                    ],
                    "å‡ ä½•å›¾å½¢": [
                        {
                            id: 5,
                            question: "åœ¨â–³ABCä¸­ï¼Œâˆ A=60Â°, âˆ B=45Â°, é‚£ä¹ˆâˆ Cç­‰äºå¤šå°‘åº¦ï¼Ÿ",
                            options: ["A. 75Â°", "B. 65Â°", "C. 85Â°", "D. 95Â°"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼šä¸‰è§’å½¢å†…è§’å’Œ180Â°ï¼Œâˆ C = 180Â° - 60Â° - 45Â° = 75Â°",
                            knowledge: "ä¸‰è§’å½¢æ€§è´¨",
                            difficulty: "ç®€å•"
                        },
                        {
                            id: 6,
                            question: "åœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œä¸¤ç›´è§’è¾¹åˆ†åˆ«ä¸º3å’Œ4ï¼Œæ±‚æ–œè¾¹é•¿",
                            options: ["A. 5", "B. 6", "C. 7", "D. 8"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼šå‹¾è‚¡å®šç†ï¼šæ–œè¾¹ = âˆš(3Â²+4Â²) = âˆš(9+16) = âˆš25 = 5",
                            knowledge: "å‹¾è‚¡å®šç†",
                            difficulty: "ç®€å•"
                        }
                    ],
                    "äºŒæ¬¡å‡½æ•°": [
                        {
                            id: 7,
                            question: "äºŒæ¬¡å‡½æ•° y = xÂ² - 4x + 3 çš„é¡¶ç‚¹åæ ‡æ˜¯ï¼Ÿ",
                            options: ["A. (2, -1)", "B. (1, 0)", "C. (4, 3)", "D. (-2, 15)"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼šé…æ–¹å¾— y = (x-2)Â² - 1ï¼Œæ‰€ä»¥é¡¶ç‚¹åæ ‡ä¸º (2, -1)",
                            knowledge: "äºŒæ¬¡å‡½æ•°",
                            difficulty: "ä¸­ç­‰"
                        }
                    ],
                    "ä»£æ•°è¿ç®—": [
                        {
                            id: 8,
                            question: "åŒ–ç®€ï¼š2(a - 3b) + 3(2a + b) = ?",
                            options: ["A. 8a - 3b", "B. 5a - 2b", "C. 4a + 9b", "D. 6a - 5b"],
                            answer: "A",
                            explanation: "ğŸ“ è§£æï¼š2(a-3b) + 3(2a+b) = 2a-6b+6a+3b = 8a-3b",
                            knowledge: "ä»£æ•°å¼åŒ–ç®€",
                            difficulty: "ç®€å•"
                        }
                    ]
                };
                
                saveAllProgress();
                init();
                alert('å·²é‡ç½®ä¸ºé»˜è®¤é¢˜ç›®ï¼');
            }
        }

        // å¢å¼ºçš„ä¿å­˜åŠŸèƒ½
        function saveAllProgress() {
            const progressData = {
                questionBank: questionBank,
                appState: {
                    score: appState.score,
                    correctCount: appState.correctCount,
                    wrongCount: appState.wrongCount,
                    wrongQuestions: appState.wrongQuestions,
                    practiceHistory: appState.practiceHistory
                },
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('mathTrainerFullProgress', JSON.stringify(progressData));
        }

        function loadAllProgress() {
            const saved = localStorage.getItem('mathTrainerFullProgress');
            if (saved) {
                try {
                    const progressData = JSON.parse(saved);
                    if (progressData.questionBank) {
                        questionBank = progressData.questionBank;
                    }
                    if (progressData.appState) {
                        Object.assign(appState, progressData.appState);
                    }
                } catch (e) {
                    console.log('åŠ è½½è¿›åº¦å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é¢˜ç›®');
                }
            }
        }

        function saveProgress() {
            saveAllProgress();
            alert('è¿›åº¦å·²ä¿å­˜åˆ°æœ¬åœ°ï¼');
        }

        // åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>